<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Farm Fresh Purchase Recorder</title>
  <!-- Tab icon (favicon) -->
  <link rel="icon" type="image/jpeg"
        href="https://static.vecteezy.com/system/resources/thumbnails/004/572/128/small/invoice-line-icon-logo-illustration-free-vector.jpg">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="card">
  <h1>Farm Fresh Purchase Recorder</h1>

  <div id="buyerSection">
    <label>Buyer Name</label>
    <input id="buyer_name" type="text" placeholder="Buyer name" required>

    <label>Address</label>
    <textarea id="address" rows="2" placeholder="Buyer address"></textarea>

    <div class="row">
      <div class="col">
        <label>Phone</label>
        <input id="phone" type="text" placeholder="0123456789">
      </div>
      <div class="col">
        <label>Invoice No</label>
        <input id="invoice_no" type="text" placeholder="1">
      </div>
      <div class="col">
        <label>Invoice Date</label>
        <input id="invoice_date" type="date" value="">
      </div>
    </div>
  </div>

  <hr style="margin:14px 0">

  <h3>Search Buyer Purchase History</h3>
  <div class="row">
    <div class="col">
        <input type="text" id="search_buyer" placeholder="Enter buyer name">
    </div>
    <div class="col" style="max-width:150px">
        <button id="searchBuyerBtn" type="button">Search</button>
    </div>
  </div>

  <div id="searchResults" class="hidden">
    <h4>Purchase History</h4>
    <table id="historyTable">
        <thead>
        <tr>
            <th>Invoice No</th>
            <th>Date</th>
            <th>Product</th>
            <th>Quantity</th>
            <th>Total (RM)</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>

    <div style="margin-top:10px;">
        <button id="downloadHistoryPDF" class="secondary">Download PDF</button>
    </div>
  </div>

  <h3>Add Product</h3>
  <div class="row">
    <div class="col">
      <label>Product Name</label>
      <input id="product_name" type="text">
    </div>
    <div class="col" style="max-width:120px">
      <label>Quantity (pcs)</label>
      <input id="quantity" type="number" min="1" value="1">
    </div>
    <div class="col" style="max-width:160px">
      <label>Price/unit (RM)</label>
      <input id="price_unit" type="number" step="0.01" value="0.00">
    </div>
    <div style="align-self:end">
      <button id="addProductBtn" type="button">Add Product</button>
    </div>
  </div>

  <table id="itemsTable" class="hidden">
    <thead>
      <tr><th>#</th><th>Product</th><th>Quantity</th><th>Price/unit (RM)</th><th>Total (RM)</th><th>Action</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="totals">
    <div>Subtotal: <strong id="subtotalText">RM 0.00</strong></div>
    <div style="display:flex;gap:8px;align-items:center">
      <label style="width:80px;margin:0">COD (RM)</label>
      <input id="cod_fees" type="number" step="0.01" value="0.00" style="width:120px">
    </div>
    <div><strong>Grand Total: <span id="grandTotalText">RM 0.00</span></strong></div>
  </div>

  <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap">
    <button id="saveInvoiceBtn">Save Invoice</button>
    <button id="downloadPDF" class="secondary hidden">Download PDF</button>
    <button id="resetBtn" class="secondary">Reset Form</button>
  </div>

  <div id="status" style="margin-top:10px;color:green"></div>
</div>

<!-- PDF libs only -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
<script src="https://unpkg.com/@supabase/supabase-js@2.39.7/dist/umd/supabase.js"></script>

<script src="script.js"></script>
</body>
</html>
